---
layout: post
mathjax: true
title: String
date: 2018-11-24-09:28:00
tag: [最小表示法,字符串---Trie]
---
* content
{:toc}
# Description




# Solution



# Code

```c++
#include <cstdio>
#include <algorithm>
using namespace std;
const int MOD=1e9+7;
const int N=66000;
int n;
int a[N];
int fact[N],iact[N],mi2[N];
int fastPow(int x,int y){
    int res=1;
    for(;y;x=1ll*x*x%MOD,y>>=1)
        if(y&1)
            res=1ll*res*x%MOD;
    return res;
}
void initFact(int n){
    fact[0]=fact[1]=1;
    for(int i=2;i<=n;i++) fact[i]=1ll*fact[i-1]*i%MOD;
    iact[0]=iact[1]=1;
    iact[n]=fastPow(fact[n],MOD-2);
    for(int i=n-1;i>=2;i--) iact[i]=1ll*iact[i+1]*(i+1)%MOD;
    mi2[0]=1;
    for(int i=1;i<=n;i++) mi2[i]=(mi2[i-1]<<1)%MOD;
}
inline int C(int n,int m){
    return (0<=m&&m<=n)?1ll*fact[n]*iact[m]%MOD*iact[n-m]%MOD:0;
}
struct BIT{
    int n;
    int a[N*2];
    void setRange(int range){
        n=range;
    }
    void add(int u,int x){
        for(;u&&u<=n;u+=u&-u)
            a[u]+=x;
    }
    int que(int u){
        int res=0;
        for(;u;u-=u&-u)
            res+=a[u];
        return res;
    }
}bitx,bity;
void readData(){
    scanf("%d",&n);
    for(int i=0;i<n;i++){
        scanf("%d",&a[i]);
        a[i]<<=1;
    }
}
void addPair(int x,int y,int sgn){
    bitx.add(x,sgn);
    bity.add(y,sgn);
}
void consider(int u,int v,int sgn){
    if(u>v)
        swap(u,v);
    addPair(u,v+1,sgn);
    addPair(v,v,sgn);
}
void buildBIT(){
    bitx.setRange(n*2+1);
    bity.setRange(n*2+1);
    for(int i=0;i<n;i+=2)
        consider(a[i],a[i+1],1);
}
void exchange(int x,int y){
    if(x==y)
        return;
    consider(a[x],a[x^1],-1);
    if((x>>1)!=(y>>1))
        consider(a[y],a[y^1],-1);
    swap(a[x],a[y]);
    consider(a[x],a[x^1],1);
    if((x>>1)!=(y>>1))
        consider(a[y],a[y^1],1);
}
int calc(int val,int other,int num){
    int sumx=bitx.que(val-1)-(other<=val-1); 
    int sumy=bity.que(val-1);
    sumx-=sumy;
    if(sumy>num)
        return 0;
    return 1ll*C(sumx,num-sumy)*mi2[(n>>1)-(sumx+(val!=other))]%MOD;
}
int query(int x,int y){ // how many situation satisfy a'[y]=a[x]
    int res=0;
    if(a[x]>a[x^1]) // single value
        res=calc(a[x],a[x],y);  
    else
        res=(calc(a[x],a[x^1]+1,y)+calc(a[x^1]+1,a[x],y))%MOD;
    res=1ll*res*fastPow(mi2[n>>1],MOD-2)%MOD;
    return res>=0?res:res+MOD;
}
void answerQuery(){
    int q;
    int opt,x,y;
    scanf("%d",&q);
    for(int i=1;i<=q;i++){
        scanf("%d%d%d",&opt,&x,&y);
        x--; y--;
        if(opt==1)
            exchange(x,y);
        else
            printf("%d\n",query(x,y));
    }
}
int main(){
    initFact(65536);
    readData();
    buildBIT();
    answerQuery();
    return 0;
}
```

