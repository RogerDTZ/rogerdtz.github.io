---
title: 时机成熟之时
mathjax: true
date: 2019-03-19 09:34:22
tags: [DP---期望概率DP]
---

# Description

有$n$种不同的物品，每种物品数量无限

每一秒，你会随机获得一种物品。若你集齐$n$种物品所需时间为$t$，消耗的总代价为$\sum_{i=1}^t i^m$

求总代价的期望值

$1 \le n \le 100$，$0 \le m \le 100$ 

<!-- more -->

# Solution

展开自然数幂求和：
$$
\sum_{i=1}^t i^m=\sum_{k=1}^m \frac {m \brace k} {k+1} (t+1)^{\underline{k+1}}
$$
则答案是一个关于$t$的$m+1$次多项式。我们可以暴力求出这个多项式，再算出$t^k$的期望就做完了

要计算结束时间的$k​$次方期望，我们用一个DP来解决：设$f_{i,j}​$表示已经获得了$i​$种物品，所需剩余时间的$j​$次方期望是多少

如果有了$1^k,2^k,\dots,x^k$，我们可以计算$(x+1)^k$：
$$
(x+1)^k=\sum_j {k \choose j}x^j
$$
则有转移：
$$
f_{i,j}=\frac i n[\sum_k {j \choose k}f_{i,k}]+\frac {n-i} n[\sum_k {j \choose k} f_{i+1,k}]
$$
$O(n^3)​$计算即可

# Code

```c++
#include <cstdio>
const int MOD=998244353;
const int N=100+10;
int n,m;
int inv[N];
int comb[N][N];
int st2[N][N];
int poly[N];
void InitArray(int n){
	inv[0]=inv[1]=1;
	for(int i=2;i<=n;i++) inv[i]=-1ll*(MOD/i)*inv[MOD%i]%MOD;
	comb[0][0]=1;
	for(int i=1;i<=n;i++){
		comb[i][0]=1;
		for(int j=1;j<=i;j++) comb[i][j]=(comb[i-1][j]+comb[i-1][j-1])%MOD;
	}
	st2[0][0]=1;
	for(int i=1;i<=n;i++)
		for(int j=1;j<=i;j++)
			st2[i][j]=(st2[i-1][j-1]+1ll*st2[i-1][j]*j)%MOD;
}
void ReadData(){
	scanf("%d%d",&n,&m);
}
void InitPoly(){
	static int cur[N];
	cur[0]=1;
	for(int a0=1,top=1,j=0;a0>-m;a0--,top++,j++){
		for(int i=top;i>0;i--)
			cur[i]=(1ll*a0*cur[i]+cur[i-1])%MOD;
		cur[0]=1ll*a0*cur[0]%MOD;
		int coef=1ll*st2[m][j]*inv[j+1]%MOD;
		for(int i=0;i<=top;i++)
			(poly[i]+=1ll*coef*cur[i]%MOD)%=MOD;
	}
}
void Calc(){
	static int f[N][N];
	f[n][0]=1;
	for(int i=n-1;i>=0;i--){
		int p=1ll*i*inv[n]%MOD;
		for(int j=0;j<=m+1;j++){
			for(int k=0;k<=j;k++){
				if(k<j)
					(f[i][j]+=1ll*p*comb[j][k]%MOD*f[i][k]%MOD)%=MOD;
				(f[i][j]+=1ll*(1-p)*comb[j][k]%MOD*f[i+1][k]%MOD)%=MOD;
			}
			f[i][j]=1ll*n*inv[n-i]%MOD*f[i][j]%MOD;
		}
	}
	int ans=0;
	for(int j=0;j<=m+1;j++)
		(ans+=1ll*poly[j]*f[0][j]%MOD)%=MOD;
	if(m==0)
		(ans-=1)%=MOD;
	printf("%d\n",ans>=0?ans:ans+MOD);
}
int main(){
	InitArray(105);
	ReadData();
	InitPoly();
	Calc();
	return 0;
}
```

