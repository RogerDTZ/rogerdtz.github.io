---
title: 序列
mathjax: true
date: 2019-03-23 11:15:53
tags: [DP---期望概率DP]
---

# Description

按如下方式随机生成一个数列：

* $a_0 = 0$
* $\forall i > 0$，$a_i$有$p_i$的概率等于$a_{i-1} + 1$，有$1-p_i$的概率等于$0$

求$(\sum_{i=1}^n a_i)^2​$的期望

$n \le 2 \times 10^6$，$p_i$在输入时输入的是$x$%

<!-- more -->

# Solution

意识流推式子题：

设$f_i$表示$a_i$的期望：$f_i=p_i(f_{i-1}+1）$

设$g_i$表示$a_i^2$的期望：$g_i=p_i(g_{i-1}+2f_{i-1}+1)$

设$h_i$表示$a_i\sum_{j<i}a_j$的期望：$h_i=p_i(h_{i-1}+(\sum_{j<i}f_j)+g_{i-1})$

答案$ans=\sum_{i}g_i+2h_i$

时间复杂度$O(n)$

# Code

```c++
#include <cstdio>
#define INV(x) FastPow(x,MOD-2)
const int MOD=998244353;
const int N=2000000+10;
int FastPow(int x,int y){
    int res=1;
    for(;y;x=1ll*x*x%MOD,y>>=1)
        if(y&1)
            res=1ll*res*x%MOD;
    return res;
}
namespace IO{
    const int LEN=20000000;
    char *inBuf,*inPtr;
    void Init(){
        inBuf=new char[LEN];
    }
    void Load(){
        fread(inBuf,1,LEN,stdin);
        inPtr=inBuf;
    }
    char GetChar(){
        return *(inPtr++);
    }
    int GetInt(){
        int x=0,f=1;
        char c=GetChar();
        while(c<'0'||c>'9'){if(c=='-')f=-1;c=GetChar();}
        while('0'<=c&&c<='9'){x=x*10+c-'0';c=GetChar();}
        return x*f;
    }
}
int n;
int p[N];
int f[N],pref[N];
int g[N];
int h[N];
void ReadData(){
    using IO::GetInt;
    n=GetInt();
    int inv100=INV(100);
    for(int i=1;i<=n;i++) p[i]=1ll*GetInt()*inv100%MOD;
}
void Calc(){
    int ans=0;
    for(int i=1;i<=n;i++){
        f[i]=1ll*p[i]*(f[i-1]+1)%MOD;
        pref[i]=(pref[i-1]+f[i])%MOD;
        g[i]=1ll*p[i]*((1ll*g[i-1]+2*f[i-1]+1)%MOD)%MOD;
        (ans+=g[i])%=MOD;
        h[i]=1ll*p[i]*((1ll*h[i-1]+(i>=2?pref[i-2]:0)+g[i-1]+f[i-1])%MOD)%MOD;
        (ans+=2ll*h[i]%MOD)%=MOD;
    }
    printf("%d\n",ans>=0?ans:ans+MOD);
}
int main(){
    IO::Init();
    IO::Load();
    ReadData();
    Calc();
    return 0;
}
```

